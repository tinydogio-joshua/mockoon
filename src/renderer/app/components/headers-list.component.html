<ng-container *ngIf="dataSubject$ | async">
  <ng-container [formGroup]="form">
    <ng-container formArrayName="headers">
      <div
        class="headers-list"
        *ngFor="let header of headers.controls; index as headerIndex"
        [formGroupName]="headerIndex"
      >
        <div class="col">
          <div class="input-group" style="position: relative">
            <input
              type="text"
              class="form-control col-5 mr-1"
              placeholder="name"
              formControlName="key"
              [ngbTypeahead]="headerNamesSearch"
            />
            <input
              type="text"
              class="form-control col-5"
              placeholder="value"
              formControlName="value"
              [ngbTypeahead]="headerValuesSearch"
            />
            <div class="input-group-prepend clickable">
              <span
                class="input-group-text p-1 text-danger"
                (click)="removeHeader(headerIndex)"
                ngbTooltip="Remove"
                ><app-svg icon="delete"></app-svg
              ></span>
            </div>
            <div
              class="input-group-prepend"
              *ngIf="testHeaderValidity(header.get('key')?.value)"
            >
              <span
                class="input-group-text p-1 text-warning"
                ngbTooltip="Header key contains prohibited characters and won't be used"
                ><app-svg icon="warning"></app-svg
              ></span>
            </div>
            <div
              class="input-group-prepend"
              *ngIf="
                ((header.get('key')?.value && !header.get('value')?.value) ||
                  (!header.get('key')?.value && header.get('value')?.value) ||
                  (!header.get('key')?.value && !header.get('value')?.value)) &&
                headerIndex < form.get('headers')['controls'].length - 1
              "
            >
              <span
                class="input-group-text p-1 text-warning"
                ngbTooltip="Headers with empty name or value are ignored"
                ><app-svg icon="warning"></app-svg
              ></span>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between">
        <button
          type="button"
          class="btn btn-link btn-icon mt-2"
          (click)="addHeader()"
        >
          <app-svg icon="add_box" class="text-success pr-2"></app-svg>
          Add header
        </button>
        <button
          *ngIf="secondaryButton"
          type="button"
          class="btn btn-link btn-icon mt-2 text-primary settings-add-cors"
          (click)="secondaryButtonClicked.emit()"
        >
          {{ secondaryButton }}
        </button>
      </div>
    </ng-container>
  </ng-container>
</ng-container>
