<div class="environments-menu d-flex flex-column h-100" appMousedragDeadzone>
  <div>
    <ul class="nav menu-header d-flex justify-content-end">
      <li class="nav-item">
        <a
          class="nav-link text-primary add-environment"
          (click)="addEnvironment()"
          ngbTooltip="New environment"
        >
          <app-svg icon="post_add"></app-svg>
        </a>
      </li>
      <li class="nav-item">
        <a
          class="nav-link text-primary open-environment"
          (click)="openEnvironment()"
          ngbTooltip="Open environment"
        >
          <app-svg icon="folder_open"></app-svg>
        </a>
      </li>
    </ul>
  </div>
  <ng-container *ngIf="environments$ | async as environments">
    <ng-container *ngIf="activeEnvironment$ | async as activeEnvironment">
      <ul
        class="nav flex-column flex-fill menu-list"
        #environmentsMenu
        cdkDropList
        (cdkDropListDropped)="reorderEnvironments($event)"
      >
        <ng-container *ngIf="environmentsStatus$ | async as environmentsStatus">
          <li
            *ngFor="let environment of environments"
            class="nav-item"
            cdkDrag
            [cdkDragDisabled]="dragDisabled"
            cdkDragLockAxis="y"
            cdkDragBoundary=".environments-menu .nav.menu-list"
          >
            <a
              class="nav-link"
              [ngClass]="{
                active: activeEnvironment?.uuid === environment.uuid,
                running:
                  environmentsStatus[environment.uuid].running &&
                  !environmentsStatus[environment.uuid].needRestart,
                'need-restart': environmentsStatus[environment.uuid].needRestart
              }"
              (click)="selectEnvironment(environment.uuid)"
              (contextmenu)="openContextMenu(environment.uuid, $event)"
            >
              <div class="d-flex">
                <div class="mw0 pr-2" [formGroup]="activeEnvironmentForm">
                  <div
                    *ngIf="
                      !editingName ||
                      activeEnvironment?.uuid !== environment.uuid
                    "
                    class="ellipsis environment-name"
                    [ngClass]="{
                      'environment-name-edit':
                        activeEnvironment?.uuid === environment.uuid
                    }"
                    (click)="
                      activeEnvironment?.uuid === environment.uuid &&
                        handleNameClick($event)
                    "
                  >
                    {{ environment.name ? environment.name : '&nbsp;' }}
                  </div>
                  <input
                    *ngIf="
                      editingName &&
                      activeEnvironment?.uuid === environment.uuid
                    "
                    class="form-control invisible-input"
                    formControlName="name"
                    [appFocusOnEvent]="focusableInputs.ENVIRONMENT_NAME"
                    type="text"
                    (click)="$event.stopPropagation()"
                    (keydown)="submitEnvironmentName($event)"
                    (blur)="disableNameEdit()"
                  />
                  <div class="menu-subtitle ellipsis">
                    <span
                      >{{ environment.hostname }}:{{ environment.port }}/{{
                        environment.endpointPrefix
                      }}</span
                    >
                  </div>
                </div>
                <div class="d-flex flex-column ml-auto">
                  <div class="server-icons server-icons-proxy-mode">
                    <app-svg
                      *ngIf="environment.proxyMode"
                      class="text-primary"
                      icon="security"
                      size="12"
                      ngbTooltip="Proxy mode enabled"
                    ></app-svg>
                    <span *ngIf="!environment.proxyMode">&nbsp;</span>
                  </div>
                  <div class="server-icons server-icons-https">
                    <app-svg
                      *ngIf="environment.https"
                      class="text-warning"
                      icon="https"
                      size="12"
                      ngbTooltip="HTTPS enabled"
                    ></app-svg>
                    <span *ngIf="!environment.https">&nbsp;</span>
                  </div>
                  <div class="server-icons server-icons-cors">
                    <app-svg
                      *ngIf="environment.cors"
                      class="text-info"
                      icon="multiple_stop"
                      size="12"
                      ngbTooltip="CORS enabled"
                    ></app-svg>
                    <span *ngIf="!environment.cors">&nbsp;</span>
                  </div>
                </div>
              </div>
            </a>
          </li>
        </ng-container>
      </ul>
    </ng-container>
  </ng-container>
  <div
    appResizeColumn
    type="environments"
    [minWidth]="menuSize"
    [maxWidthFactor]="0.2"
    class="resize-column"
  ></div>
</div>
